{% load static %}
{% load i18n %}
<!DOCTYPE html>

<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}عنوان پیش‌فرض{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/4a2a05a158.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


<script>

     window.onload = function() {
         document.addEventListener("DOMContentLoaded", function () {
             let audio = document.getElementById("background-music");
             const toggleButton = document.getElementById("play-music");

             // اگر فایل صوتی قبلاً تعریف نشده، آن را ایجاد کنید
             if (!window.audioInstance) {
                 window.audioInstance = new Audio("/path/to/audio/file.mp3");
                 audio = window.audioInstance;
                 audio.loop = true;

                 // تنظیم زمان و وضعیت از localStorage
                 const savedTime = parseFloat(localStorage.getItem("audioTime")) || 0;
                 const isPlaying = localStorage.getItem("audioPlaying") === "true";

                 audio.addEventListener("loadedmetadata", function () {
                     audio.currentTime = savedTime;
                     if (isPlaying) audio.play();
                 });

                 audio.addEventListener("timeupdate", function () {
                     localStorage.setItem("audioTime", audio.currentTime.toString());
                 });
             } else {
                 // استفاده از نمونه قبلی فایل صوتی
                 audio = window.audioInstance;
             }

             // مدیریت وضعیت پخش با دکمه
             toggleButton.addEventListener("click", function () {
                 if (audio.paused) {
                     audio.play();
                     toggleButton.innerHTML = '<i class="fa-solid fa-volume-high"></i>';
                     localStorage.setItem("audioPlaying", "true");
                 } else {
                     audio.pause();
                     toggleButton.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
                     localStorage.setItem("audioPlaying", "false");
                 }
             });

             // به‌روزرسانی وضعیت دکمه
             if (audio.paused) {
                 toggleButton.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
             } else {
                 toggleButton.innerHTML = '<i class="fa-solid fa-volume-high"></i>';
             }
         });

     }
</script>

    <style>

    </style>

</head>
<body>
    <!-- پخش موسیقی در تمام صفحات (با استفاده از جاوا اسکریپت) -->
    <audio id="background-music" loop>
        <source src="{% static 'audio/playback.mp3' %}" type="audio/mpeg">
        مرورگر شما از تگ audio پشتیبانی نمی‌کند.
    </audio>

    <header>
         {% block header %}

        {% endblock %}
    </header>
    <!-- محتوای متغیر -->
    <div id="content">
        {% block content %}
        {% endblock %}
    </div>

{#    <div class="fab-container">#}
{#  <div class="fab shadow">#}
{#    <div class="fab-content">#}
{#      <i class="fa-solid fa-gear"></i>#}
{#    </div>#}
{#  </div>#}
{##}
{#    <div class="sub-button shadow">#}
{#    <a id="play-music" target="_blank">#}
{#        <i class="fa-solid fa-volume-xmark"></i>#}
{#    </a>#}
{#  </div>#}
{##}
{#    <div class="sub-button shadow">#}
{#    <a target="_blank">#}
{#      <i class="fa-solid fa-file-lines"></i>#}
{#    </a>#}
{#  </div>#}
{##}
{#         {% block fab_buttons %}#}
{##}
{#         {% endblock %}#}
{##}
{#</div>#}
 <!-- فوتر -->
    <footer>
            {% block footer_buttons %}

            {% endblock %}
    </footer>
</body>

</html>
